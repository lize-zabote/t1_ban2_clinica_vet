--
-- Banco de Dados - Petshop / Agendamento de Serviços
--

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Tabela: Serviço
--
CREATE TABLE public.servico (
    idServico integer NOT NULL,
    valor numeric(10,2) NOT NULL,
    descricao character varying(100) NOT NULL
);
ALTER TABLE public.servico OWNER TO postgres;

-- Sequência para idServico
CREATE SEQUENCE public.servico_a_seq;
ALTER TABLE public.servico ALTER COLUMN idServico SET DEFAULT nextval('public.servico_a_seq');

--
-- Tabela: Cliente
--
CREATE TABLE public.cliente (
    idCliente integer NOT NULL,
    nome character varying(40) NOT NULL,
    sobrenome character varying(40) NOT NULL,
    telefone character varying(15),
    cep character varying(10),
    bairro character varying(50),
    rua character varying(80)
);
ALTER TABLE public.cliente OWNER TO postgres;

-- Sequência para idCliente
CREATE SEQUENCE public.cliente_a_seq;
ALTER TABLE public.cliente ALTER COLUMN idCliente SET DEFAULT nextval('public.cliente_a_seq');


--
-- Tabela: Funcionário
--
CREATE TABLE public.funcionario (
    idFuncionario integer NOT NULL,
    nome character varying(40) NOT NULL,
    sobrenome character varying(40) NOT NULL,
    rua character varying(80),
    cep character varying(10),
    bairro character varying(50),
    especialidade character varying(50),
    cargo character varying(50)
);
ALTER TABLE public.funcionario OWNER TO postgres;

-- Sequência para idFuncionario
CREATE SEQUENCE public.funcionario_a_seq;
ALTER TABLE public.funcionario ALTER COLUMN idFuncionario SET DEFAULT nextval('public.funcionario_a_seq');


--
-- Tabela: Espécie
--
CREATE TABLE public.especie (
    idEspecie integer NOT NULL,
    descricao character varying(50) NOT NULL
);
ALTER TABLE public.especie OWNER TO postgres;

-- Sequência para idEspecie
CREATE SEQUENCE public.especie_a_seq;
ALTER TABLE public.especie ALTER COLUMN idEspecie SET DEFAULT nextval('public.especie_a_seq');


--
-- Tabela: Animal
--
CREATE TABLE public.animal (
    idAnimal integer NOT NULL,
    nome character varying(40) NOT NULL,
    dataNascimento date,
    idEspecie integer NOT NULL,
    idCliente integer NOT NULL
);
ALTER TABLE public.animal OWNER TO postgres;

-- Sequência para idAnimal
CREATE SEQUENCE public.animal_a_seq;
ALTER TABLE public.animal ALTER COLUMN idAnimal SET DEFAULT nextval('public.animal_a_seq');


--
-- Tabela: Agendamento
--
CREATE TABLE public.agendamento (
    idAgendamento integer NOT NULL,
    data date NOT NULL,
    hora time without time zone NOT NULL,
    idServico integer NOT NULL,
    idAnimal integer NOT NULL
);
ALTER TABLE public.agendamento OWNER TO postgres;

-- Sequência para idAgendamento
CREATE SEQUENCE public.agendamento_a_seq;
ALTER TABLE public.agendamento ALTER COLUMN idAgendamento SET DEFAULT nextval('public.agendamento_a_seq');


--
-- Tabela: Atendimento
--
CREATE TABLE public.atendimento (
    idAgendamento integer NOT NULL,
    idFuncionario integer NOT NULL
);
ALTER TABLE public.atendimento OWNER TO postgres;

-------------------------------------------------
-- Constraints (PKs)
-------------------------------------------------
ALTER TABLE ONLY public.servico
    ADD CONSTRAINT servico_pkey PRIMARY KEY (idServico);
ALTER TABLE ONLY public.cliente
    ADD CONSTRAINT cliente_pkey PRIMARY KEY (idCliente);
ALTER TABLE ONLY public.funcionario
    ADD CONSTRAINT funcionario_pkey PRIMARY KEY (idFuncionario);
ALTER TABLE ONLY public.especie
    ADD CONSTRAINT especie_pkey PRIMARY KEY (idEspecie);
ALTER TABLE ONLY public.animal
    ADD CONSTRAINT animal_pkey PRIMARY KEY (idAnimal);
ALTER TABLE ONLY public.agendamento
    ADD CONSTRAINT agendamento_pkey PRIMARY KEY (idAgendamento);
ALTER TABLE ONLY public.atendimento
    ADD CONSTRAINT atendimento_pkey PRIMARY KEY (idAgendamento, idFuncionario);
-------------------------------------------------
-- Constraints (FKs)
-------------------------------------------------
ALTER TABLE ONLY public.animal
    ADD CONSTRAINT animal_idcliente_fkey FOREIGN KEY (idCliente) REFERENCES public.cliente(idCliente);
ALTER TABLE ONLY public.animal
    ADD CONSTRAINT animal_idespecie_fkey FOREIGN KEY (idEspecie) REFERENCES public.especie(idEspecie);
ALTER TABLE ONLY public.agendamento
    ADD CONSTRAINT agendamento_idservico_fkey FOREIGN KEY (idServico) REFERENCES public.servico(idServico);
ALTER TABLE ONLY public.agendamento
    ADD CONSTRAINT agendamento_idanimal_fkey FOREIGN KEY (idAnimal) REFERENCES public.animal(idAnimal);
ALTER TABLE ONLY public.atendimento
    ADD CONSTRAINT atendimento_idagendamento_fkey FOREIGN KEY (idAgendamento) REFERENCES public.agendamento(idAgendamento);
ALTER TABLE ONLY public.atendimento
    ADD CONSTRAINT atendimento_idfuncionario_fkey FOREIGN KEY (idFuncionario) REFERENCES public.funcionario(idFuncionario);


-- População de dados

TRUNCATE TABLE public.atendimento, public.agendamento, public.animal, public.cliente, public.funcionario, public.servico, public.especie RESTART IDENTITY CASCADE;

-------------------------------------------------
-- Tabela: Espécie
-------------------------------------------------
INSERT INTO public.especie (descricao) VALUES
('Cachorro'),
('Gato'),
('Pássaro'),
('Hamster');

-------------------------------------------------
-- Tabela: Serviço
-------------------------------------------------
INSERT INTO public.servico (valor, descricao) VALUES
(80.00, 'Banho e Tosa Completa'),
(50.00, 'Banho Simples'),
(150.00, 'Consulta Veterinária'),
(90.00, 'Aplicação de Vacina V10'),
(40.00, 'Corte de Unhas');
-------------------------------------------------
-- Tabela: Cliente
-------------------------------------------------
INSERT INTO public.cliente (nome, sobrenome, telefone, cep, bairro, rua) VALUES
('Ana', 'Silva', '(47) 99988-7766', '89220-100', 'Costa e Silva', 'Rua das Palmeiras, 123'),
('Bruno', 'Costa', '(47) 98877-6655', '89204-250', 'América', 'Rua XV de Novembro, 456'),
('Carla', 'Oliveira', '(47) 97766-5544', '89211-500', 'Santo Antônio', 'Rua Marquês de Olinda, 789'),
('Daniel', 'Pereira', '(47) 96655-4433', '89223-005', 'Aventureiro', 'Rua Tuiuti, 101'),
('Eduarda', 'Martins', '(47) 95544-3322', '89202-300', 'Atiradores', 'Rua Eusébio de Queiroz, 212');
-------------------------------------------------
-- Tabela: Funcionário
-------------------------------------------------
INSERT INTO public.funcionario (nome, sobrenome, rua, cep, bairro, especialidade, cargo) VALUES
('Fernanda', 'Lima', 'Rua dos Girassóis, 321', '89221-500', 'Saguaçu', 'Tosa Japonesa', 'Tosadora'),
('Gustavo', 'Almeida', 'Rua das Orquídeas, 654', '89203-400', 'Anita Garibaldi', 'Clínica Geral de Pequenos Animais', 'Veterinário'),
('Heloísa', 'Ribeiro', 'Avenida Central, 987', '89201-001', 'Centro', NULL, 'Recepcionista'),
('Igor', 'Santos', 'Rua Blumenau, 741', '89204-251', 'América', 'Tosa na tesoura', 'Tosador');
-------------------------------------------------
-- Tabela: Animal
-------------------------------------------------
-- idAnimal, nome, dataNascimento, idEspecie, idCliente
INSERT INTO public.animal (nome, dataNascimento, idEspecie, idCliente) VALUES
('Thor', '2022-05-10', 1, 1),    -- Cachorro de Ana
('Mia', '2021-11-20', 2, 1),     -- Gato de Ana
('Loki', '2023-01-15', 1, 2),    -- Cachorro de Bruno
('Zazu', '2024-03-30', 3, 3),    -- Pássaro de Carla
('Bolinha', '2023-08-01', 4, 4), -- Hamster de Daniel
('Nina', '2020-07-25', 1, 5),    -- Cachorro de Eduarda
('Simba', '2022-09-12', 2, 5);   -- Gato de Eduarda

-------------------------------------------------
-- Tabela: Agendamento
-------------------------------------------------
-- idAgendamento, data, hora, idServico, idAnimal
INSERT INTO public.agendamento (data, hora, idServico, idAnimal) VALUES
('2025-10-10', '10:00:00', 1, 1), -- Thor, Banho e Tosa
('2025-10-11', '14:30:00', 3, 2), -- Mia, Consulta
('2025-10-12', '09:00:00', 2, 3), -- Loki, Banho Simples
('2025-10-12', '11:00:00', 4, 6), -- Nina, Vacina
('2025-10-15', '16:00:00', 5, 7), -- Simba, Corte de Unhas
('2025-10-18', '13:00:00', 1, 6); -- Nina, Banho e Tosa

-------------------------------------------------
-- Tabela: Atendimento (Ligação Agendamento x Funcionário)
-------------------------------------------------
-- idAgendamento, idFuncionario
INSERT INTO public.atendimento (idAgendamento, idFuncionario) VALUES
(1, 1), -- Agendamento 1 (Thor, Banho e Tosa) feito pela Tosadora Fernanda (ID 1)
(2, 2), -- Agendamento 2 (Mia, Consulta) feito pelo Veterinário Gustavo (ID 2)
(3, 4), -- Agendamento 3 (Loki, Banho Simples) feito pelo Tosador Igor (ID 4)
(4, 2), -- Agendamento 4 (Nina, Vacina) feito pelo Veterinário Gustavo (ID 2)
(5, 2), -- Agendamento 5 (Simba, Corte de Unhas) feito pelo Veterinário Gustavo (ID 2)
(6, 4); -- Agendamento 6 (Nina, Banho e Tosa) feito pelo Tosador Igor (ID 4)

--
-- FIM DO SCRIPT
--
