--
-- Banco de Dados - Petshop / Agendamento de Serviços
--

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Tabela: Serviço
--
CREATE TABLE public.servico (
    idServico integer NOT NULL,
    valor numeric(10,2) NOT NULL,
    descricao character varying(100) NOT NULL
);
ALTER TABLE public.servico OWNER TO postgres;

-- Sequência para idServico
CREATE SEQUENCE public.servico_a_seq;
ALTER TABLE public.servico ALTER COLUMN idServico SET DEFAULT nextval('public.servico_a_seq');

--
-- Tabela: Cliente
--
CREATE TABLE public.cliente (
    idCliente integer NOT NULL,
    nome character varying(40) NOT NULL,
    sobrenome character varying(40) NOT NULL,
    telefone character varying(15),
    cep character varying(10),
    bairro character varying(50),
    rua character varying(80)
);
ALTER TABLE public.cliente OWNER TO postgres;

-- Sequência para idCliente
CREATE SEQUENCE public.cliente_a_seq;
ALTER TABLE public.cliente ALTER COLUMN idCliente SET DEFAULT nextval('public.cliente_a_seq');


--
-- Tabela: Funcionário
--
CREATE TABLE public.funcionario (
    idFuncionario integer NOT NULL,
    nome character varying(40) NOT NULL,
    sobrenome character varying(40) NOT NULL,
    rua character varying(80),
    cep character varying(10),
    bairro character varying(50),
    especialidade character varying(50),
    cargo character varying(50)
);
ALTER TABLE public.funcionario OWNER TO postgres;

-- Sequência para idFuncionario
CREATE SEQUENCE public.funcionario_a_seq;
ALTER TABLE public.funcionario ALTER COLUMN idFuncionario SET DEFAULT nextval('public.funcionario_a_seq');


--
-- Tabela: Espécie
--
CREATE TABLE public.especie (
    idEspecie integer NOT NULL,
    descricao character varying(50) NOT NULL
);
ALTER TABLE public.especie OWNER TO postgres;

-- Sequência para idEspecie
CREATE SEQUENCE public.especie_a_seq;
ALTER TABLE public.especie ALTER COLUMN idEspecie SET DEFAULT nextval('public.especie_a_seq');


--
-- Tabela: Animal
--
CREATE TABLE public.animal (
    idAnimal integer NOT NULL,
    nome character varying(40) NOT NULL,
    dataNascimento date,
    idEspecie integer NOT NULL,
    idCliente integer NOT NULL
);
ALTER TABLE public.animal OWNER TO postgres;

-- Sequência para idAnimal
CREATE SEQUENCE public.animal_a_seq;
ALTER TABLE public.animal ALTER COLUMN idAnimal SET DEFAULT nextval('public.animal_a_seq');


--
-- Tabela: Agendamento
--
CREATE TABLE public.agendamento (
    idAgendamento integer NOT NULL,
    data date NOT NULL,
    hora time without time zone NOT NULL,
    idServico integer NOT NULL,
    idAnimal integer NOT NULL
);
ALTER TABLE public.agendamento OWNER TO postgres;

-- Sequência para idAgendamento
CREATE SEQUENCE public.agendamento_a_seq;
ALTER TABLE public.agendamento ALTER COLUMN idAgendamento SET DEFAULT nextval('public.agendamento_a_seq');


--
-- Tabela: Atendimento
--
CREATE TABLE public.atendimento (
    idAgendamento integer NOT NULL,
    idFuncionario integer NOT NULL
);
ALTER TABLE public.atendimento OWNER TO postgres;

-------------------------------------------------
-- Constraints (PKs)
-------------------------------------------------
ALTER TABLE ONLY public.servico
    ADD CONSTRAINT servico_pkey PRIMARY KEY (idServico);

ALTER TABLE ONLY public.cliente
    ADD CONSTRAINT cliente_pkey PRIMARY KEY (idCliente);

ALTER TABLE ONLY public.funcionario
    ADD CONSTRAINT funcionario_pkey PRIMARY KEY (idFuncionario);

ALTER TABLE ONLY public.especie
    ADD CONSTRAINT especie_pkey PRIMARY KEY (idEspecie);

ALTER TABLE ONLY public.animal
    ADD CONSTRAINT animal_pkey PRIMARY KEY (idAnimal);

ALTER TABLE ONLY public.agendamento
    ADD CONSTRAINT agendamento_pkey PRIMARY KEY (idAgendamento);

ALTER TABLE ONLY public.atendimento
    ADD CONSTRAINT atendimento_pkey PRIMARY KEY (idAgendamento, idFuncionario);

-------------------------------------------------
-- Constraints (FKs)
-------------------------------------------------
ALTER TABLE ONLY public.animal
    ADD CONSTRAINT animal_idcliente_fkey FOREIGN KEY (idCliente) REFERENCES public.cliente(idCliente);

ALTER TABLE ONLY public.animal
    ADD CONSTRAINT animal_idespecie_fkey FOREIGN KEY (idEspecie) REFERENCES public.especie(idEspecie);

ALTER TABLE ONLY public.agendamento
    ADD CONSTRAINT agendamento_idservico_fkey FOREIGN KEY (idServico) REFERENCES public.servico(idServico);

ALTER TABLE ONLY public.agendamento
    ADD CONSTRAINT agendamento_idanimal_fkey FOREIGN KEY (idAnimal) REFERENCES public.animal(idAnimal);

ALTER TABLE ONLY public.atendimento
    ADD CONSTRAINT atendimento_idagendamento_fkey FOREIGN KEY (idAgendamento) REFERENCES public.agendamento(idAgendamento);

ALTER TABLE ONLY public.atendimento
    ADD CONSTRAINT atendimento_idfuncionario_fkey FOREIGN KEY (idFuncionario) REFERENCES public.funcionario(idFuncionario);

--
-- FIM DO SCRIPT
--